<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>7-index</title>
  </head>
  <body>
    <script type="application/javascript">
      const availableItems = ["Shampoo", "Soap", "Sponge", "Water"];
      if (typeof(Storage) === "undefined") {
        alert("Sorry, your browser does not support Web storage. Try again with a better one");
      } else {
        createStore();
        displayCart();
      }

      function getCartFromStorage() {
        const cart = sessionStorage.getItem("cart");
        if (cart) {
          return JSON.parse(cart);
        } else {
          return {};
        }
      }

      function addItemToCart(item) {
        const cart = getCartFromStorage();
        if (cart.hasOwnProperty(item)) {
          cart[item]++;
        } else {
          cart[item] = 1;
        }
        sessionStorage.setItem("cart", JSON.stringify(cart));
        displayCart();
      }

      function removeItemfromCart(item) {
        const cart = getCartFromStorage();
        if (cart[item]) delete cart[item];
        sessionStorage.setItem("cart", JSON.stringify(cart));
        displayCart();
      }

      function clearCart() {
        sessionStorage.clear();
        displayCart();
      }

      function createStore() {
        const store = document.createElement("div")
        const title = document.createElement("h2");
        title.textContent = "Available products:";
        store.appendChild(title);
        const list = document.createElement("ul");
        for (let idx = 0; idx < availableItems.length; idx++) {
          const item = document.createElement("li");
          item.textContent = availableItems[idx];
          item.onclick = function() {
            addItemToCart(this.innerHTML);
          }
          list.append(item);
        }
        store.appendChild(list);
        document.body.appendChild(store);
      }

      function displayCart() {
        const title = document.getElementById("cart");
        if (title) {
          title.remove();
        }
        const newTitle = document.createElement("h2");
        newTitle.setAttribute("id", "cart");
        newTitle.textContent = "Your cart:";

        const cartDiv = document.getElementById("cartDiv");
        if (cartDiv) {
          cartDiv.remove();
        }
        const newDiv = document.createElement("div");
        newDiv.setAttribute("id", "cartDiv");

        document.body.appendChild(newTitle);
        document.body.appendChild(newDiv);

        updateCart();
      }

      function updateCart() {
        const cart = getCartFromStorage();
        const list = document.createElement("ul");
        if (Object.keys(cart).length === 0) {
          const empty = document.createElement("li");
          empty.textContent = "Your cart is empty";
          list.appendChild(empty);
        } else {
          const clear = document.createElement("li");
          clear.textContent = "Clear my cart";
          clear.onclick = clearCart;
          list.appendChild(clear);
          for (let item in cart) {
            let li = document.createElement("li");
            li.textContent = item + " X " + cart[item] + " ";
            const remove = document.createElement("span");
            remove.textContent = "(remove)";
            remove.addEventListener("click", function() {
              removeItemfromCart(item);
            })
            li.appendChild(remove);
            list.appendChild(li);
          }
        }
        document.getElementById("cartDiv").appendChild(list);
      }
    </script>
  </body>
</html>
